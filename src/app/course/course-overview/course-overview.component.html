<div class="container-fluid mt-4">
  <div class="row">
    <div class="col-lg-8">
      <div *ngIf="selectedVideo" class="mb-4">
        <h3 class="fw-bold text-primary mb-3"><i class="fas fa-play-circle me-2"></i>{{ selectedVideo.title }}</h3>

        <div class="video-wrapper shadow rounded overflow-hidden mb-3">
          <video
            class="w-100"
            height="400"
            controls
            [attr.controlsList]="'nodownload'"
            [src]="selectedVideo?.selectedQuality"
            (contextmenu)="disableRightClick($event)"
          ></video>
        </div>

        <div class="btn-group mb-3" role="group">
          <button
            *ngIf="selectedVideo.quality1080"
            type="button"
            class="btn btn-outline-primary"
            [class.active]="selectedVideo.selectedQuality === selectedVideo.quality1080"
            (click)="changeQuality('quality1080')"
          >
            1080p
          </button>
          <button
            *ngIf="selectedVideo.quality720"
            type="button"
            class="btn btn-outline-primary"
            [class.active]="selectedVideo.selectedQuality === selectedVideo.quality720"
            (click)="changeQuality('quality720')"
          >
            720p
          </button>
          <button
            *ngIf="selectedVideo.quality480"
            type="button"
            class="btn btn-outline-primary"
            [class.active]="selectedVideo.selectedQuality === selectedVideo.quality480"
            (click)="changeQuality('quality480')"
          >
            480p
          </button>
        </div>

        <div class="mt-4 text-wrap" >
          <h5 class="fw-semibold"><i class="fas fa-align-left me-2"></i>Video Description</h5>
          <div style="width: 100%; overflow-wrap: break-word;">
            <p class="text-muted " >{{ selectedVideo.description }}</p>
          </div>
        </div>

        <div *ngIf="userRole === 'Student'" class="card shadow-sm border-0 mt-4">
          <div class="card-body">
            <h5 class="fw-semibold text-danger mb-3"><i class="fas fa-question-circle me-2"></i> Raise a Doubt</h5>
            <input [(ngModel)]="doubtTitle" placeholder="Enter doubt title" class="form-control mb-2" />
            <textarea [(ngModel)]="doubtDescription" placeholder="Describe your doubt..." class="form-control mb-2" rows="3"></textarea>
            <button class="btn btn-primary px-4" (click)="raiseDoubt()">Submit Doubt</button>
          </div>
        </div>

        <div *ngIf="userRole === 'Student' && doubts.length > 0" class="card mt-4 shadow-sm border-0">
          <div class="card-body">
            <h5 class="fw-semibold text-success mb-3"><i class="fas fa-comment-dots me-2"></i> Your Doubts</h5>

            <div class="doubts-scroll-container">
              <div *ngFor="let doubt of doubts" class="p-3 my-2 rounded border" 
                  [ngClass]="{'bg-light': doubt.replies.length > 0}">
                <strong>{{ doubt.title }}</strong>
                <p class="mb-1">{{ doubt.description }}</p>

                <div *ngIf="doubt.replies.length > 0" class="p-2 bg-success bg-opacity-10 rounded">
                  <strong>âœ… Resolved by {{ doubt.replies[0].teacher.fullName }}</strong>
                  <p class="mb-0">{{ doubt.replies[0].replyText }}</p>
                </div>

                <div *ngIf="doubt.replies.length === 0" class="text-muted small fst-italic">
                  Waiting for teacher's reply...
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div *ngIf="!selectedVideo" class="alert alert-info text-center">
        ðŸŽ¬ Select a video to start learning
      </div>

      <div class="mt-4" *ngIf="!selectedVideo && course?.courseDescription">
        <h5 class="fw-semibold"><i class="fas fa-book-open me-2"></i> Course Description</h5>
        <p class="text-muted">{{ course.courseDescription }}</p>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="sticky-top" style="top: 20px;">
        <div class="mb-4">
          <h5 class="fw-semibold"><i class="fas fa-vial me-2"></i> Quizzes</h5>
          <div *ngIf="quizzes.length > 0" class="list-group">
            <a
              *ngFor="let quiz of quizzes"
              class="list-group-item list-group-item-action quiz-item d-flex justify-content-between align-items-center"
              [routerLink]="['/quiz-detail', quiz.id]"
            >
              <div>
                <span class="fw-bold text-primary">{{ quiz.title }}</span>
                <div *ngIf="userRole == 'Student' && quiz.attemptCount > 0 " class="small text-muted">
                  {{ quiz.canAttempt - quiz.attemptCount }} attempt(s) remaining
                </div>
                <div *ngIf="userRole == 'Student' && quiz.attemptCount === 0 " class="small text-muted">
                 Attempt Now
                </div>
              </div>
              <i class="fas fa-arrow-right text-secondary"></i>
            </a>
          </div>
          <div *ngIf="quizzes.length === 0" class="alert alert-warning mt-2">
            No quizzes available yet.
          </div>
          <div class="mt-2 text-center">
            <button *ngIf="userRole === 'Teacher'" class="btn btn-success me-2" (click)="addQuiz()"><i class="fas fa-plus me-1"></i> Add Quiz</button>
            <button *ngIf="userRole === 'Teacher'" class="btn btn-outline-primary" [routerLink]="['/doubts', courseId]">
              <i class="fas fa-users me-1"></i>Student Doubts
            </button>
            <button *ngIf="userRole === 'Teacher'" class="btn btn-info mt-2" [routerLink]="['/quiz-results', courseId]">
              <i class="fas fa-chart-line me-1"></i> View Quiz Results
            </button>
          </div>
        </div>

        <h5 class="fw-semibold"><i class="fas fa-play-circle me-2"></i> Course Videos</h5>
        <input type="text" class="form-control mb-3" placeholder="ðŸ” Search videos..." [(ngModel)]="searchTerm" />

        <div class="video-scroll-container">
          <div *ngFor="let video of filteredVideos" class="video-item card border-0 shadow-sm p-2 mb-3" (click)="playVideo(video)" >
            <div class="fw-semibold text-primary mb-1">{{ video.title }}</div>
            <img [src]="video.thumbnailPath" class="img-fluid rounded" style="height: 180px; object-fit: cover;"
            />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
